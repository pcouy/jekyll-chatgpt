<div class="chatgpt-message" id="{{include.message.id}}">
    {% if include.message.message %}
        <div class="chatgpt-messagebody chatgpt-role-{{ include.message.message.author.role }}">
            {% if mdfy %}
                {{ include.message.message.content.parts[0] | markdownify }}
            {% else %}
                <pre>{{ include.message.message.content.parts[0] }}</pre>
            {% endif %}
        </div>
    {% endif %}
    <div class="chatgpt-messagechildren">
    {% for child_id in include.message.children %}
        {% assign inner_message=conversation.mapping[child_id] %}
        <div class="chatgpt-messagechild">
            <input type="radio"
                name="chatgpt-{{ include.message.id }}"
                id="chatgpt-control-{{ inner_message.id }}"
                class="chatgpt-control"
                {% if forloop.first %}checked{% endif %}
            >
            <label for="chatgpt-control-{{ inner_message.id }}">{{ forloop.index }}</label>
            {% include chatgpt_message.html message=inner_message %}
            {% comment %}
              # `inner_message` is no longer valid after the include, because it will
              # be overrided during the recursion. This is not a problem as long as
              # we're only closing tags after the include
            {% endcomment %}
        </div>
    {% endfor %}
    </div>
</div>
